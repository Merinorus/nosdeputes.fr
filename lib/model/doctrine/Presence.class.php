<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Presence extends BasePresence
{
  public function addPreuve($type, $source) {
    $q = Doctrine::getTable('PreuvePresence')->createQuery('p')
      ->where('presence_id = ?', $this->id)
      ->andWhere('type = ?', $type);
    if ($type != 'intervention')
      $q->andWhere('source = ?', $source);
    $preuve = $q->fetchOne();
    $q->free();

    if (!$preuve) {
      $preuve = new PreuvePresence();
      $preuve->presence_id = $this->id;
      $preuve->type = $type;
      $preuve->source = $source;

      $this->nb_preuves++ ;
    }

    $res = $preuve->save();
    $this->save();
    $preuve->free();
    return $res;
  }

  public function delPreuve($type, $source) {
    $q = Doctrine::getTable('PreuvePresence')->createQuery('p')
      ->where('presence_id = ?', $this->id)
      ->andWhere('type = ?', $type);
    if ($type != 'intervention')
      $q->andWhere('source = ?', $source);
    $preuve = $q->fetchOne();
    $q->free();

    if ($preuve) {
      $preuve->delete();
      $preuve->free();

      $this->nb_preuves--;
      $this->save();
    }
  }

  public function getGroupeAcronyme() {
    return myTools::getObjectGroupeAcronyme($this);
  }

}
